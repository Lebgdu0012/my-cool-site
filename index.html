<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diffusion Vidéo en Direct</title>
  <link rel="stylesheet" href="style.css"> <!-- Lien vers le fichier CSS externe -->
</head>
<body>

  <h1>Diffusion Vidéo en Direct</h1>

  <div class="videos-container">
    <video id="myVideo" autoplay muted></video> <!-- Vidéo de l'utilisateur -->
    <video id="remoteVideo" autoplay></video> <!-- Vidéo des autres utilisateurs -->
  </div>

  <button id="startButton">Démarrer la caméra</button>

  <script>
    // Variables pour gérer les éléments vidéo et la connexion WebRTC
    let localStream;
    let peerConnection;
    const myVideo = document.getElementById('myVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const startButton = document.getElementById('startButton');

    // Fonction pour démarrer la caméra locale
    async function startCamera() {
      try {
        // Accéder à la caméra de l'utilisateur
        localStream = await navigator.mediaDevices.getUserMedia({ video: true });
        myVideo.srcObject = localStream;  // Afficher la vidéo locale
        startButton.disabled = true;      // Désactiver le bouton une fois la caméra lancée
        
        // Créer la connexion WebRTC pour diffuser la vidéo
        createPeerConnection();
      } catch (error) {
        console.error('Erreur lors de l\'accès à la caméra', error);
      }
    }

    // Fonction pour créer une connexion WebRTC
    function createPeerConnection() {
      const config = {
        iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] // Serveur STUN pour obtenir les adresses IP publiques
      };
      peerConnection = new RTCPeerConnection(config);

      // Ajouter le flux local (de la caméra) à la connexion WebRTC
      localStream.getTracks().forEach(track => {
        peerConnection.addTrack(track, localStream);
      });

      // Quand un flux distant est reçu, on l'affiche dans la vidéo distante
      peerConnection.ontrack = (event) => {
        remoteVideo.srcObject = event.streams[0];
      };

      // Créer une offre WebRTC (pour démarrer la communication)
      peerConnection.createOffer()
        .then(offer => peerConnection.setLocalDescription(offer))
        .then(() => {
          // Ici, on enverrait l'offre à un autre utilisateur via WebSocket ou autre mécanisme
          // En simulation, on peut juste loguer l'offre
          console.log('Offre WebRTC envoyée : ', peerConnection.localDescription);
        });
    }

    // Écouteur pour démarrer la caméra
    startButton.addEventListener('click', startCamera);
  </script>

</body>
</html>
